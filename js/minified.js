function Loading(){var a=function(){var a=document.createElement("div"),b="loadingPage",c=document.getElementsByTagName("body")[0];a.setAttribute("class",b),c.appendChild(a);var d=document.createElement("div"),b="loadingWrp",c=document.getElementsByClassName("loadingPage")[0];return d.setAttribute("class",b),c.appendChild(d),a},b=function(){var a=document.createElement("div"),b=document.getElementsByClassName("loadingWrp")[0];return a.style.height="100%",a.style.width="100%",a.style.backgroundColor="green",a.style.position="absolute",a.style.right="90%",b.appendChild(a),a},c=function(){e.pageElement.style.visibility="hidden"},d=function(a){e.moveElement.style.right=a+"%"};this.pageElement=a(),this.moveElement=b();var e=this,f=100;this.loadingMover=function(a){var b=100/a;f-=b,d(f),f<=0&&(c(),f=100)}}function Ball(a){var b=function(a){var b=document.createElement("div"),c=document.getElementsByClassName("board")[0];return b.setAttribute("class",a),c.appendChild(b),b},c=function(){g.element.style.left=g.posX+"px",g.element.style.top=g.posY+"px"},d=function(){1==g.deadFlag?g.element.style.visibility="hidden":g.element.style.visibility="visible"};this.element=b(a);var e=.03,f=.098,g=this;this.velX=0,this.velY=0,this.posX,this.posY,this.radius=12,this.mass=1,this.identity,this.velFlag=!1,this.deadFlag=!1,this.collisonFactor=.95;var i=function(a,b){return Math.sqrt(Math.pow(a,2)+Math.pow(b,2))};this.initialise=function(a,b,d){g.posX=a,g.posY=b,g.identity=d,c()},this.move=function(a){g.posX+=g.velX,g.posY+=g.velY;var b=Math.sqrt(Math.pow(g.velX,2)+Math.pow(g.velY,2));b>0?g.velFlag=!0:g.velFlag=!1;var d=b-e*f;d>.8?(g.velX*=d/b,g.velY*=d/b):(g.velX=0,g.velY=0),c()},this.makeDead=function(){g.velX=0,g.velY=0,g.deadFlag=!0,g.posX=0,g.posY=0,d()},this.hitTest=function(a){var b=Math.sqrt(Math.pow(this.posX-a.posX,2)+Math.pow(this.posY-a.posY,2));if(b<=g.radius+a.radius){var c=(a.posX-g.posX)/b,d=(a.posY-g.posY)/b,e=2*(g.velX*c+g.velY*d-a.velX*c-a.velY*d)/(g.mass+a.mass);g.velX=(g.velX-e*g.mass*c)*g.collisonFactor,g.velY=(g.velY-e*g.mass*d)*g.collisonFactor,a.velX=(a.velX+e*a.mass*c)*g.collisonFactor,a.velY=(a.velY+e*a.mass*d)*g.collisonFactor;var f=(g.posX+a.posX)/2,h=(g.posY+a.posY)/2;g.posX=f+g.radius*(g.posX-a.posX)/b,g.posY=h+g.radius*(g.posY-a.posY)/b,a.posX=f+a.radius*(a.posX-g.posX)/b,a.posY=h+a.radius*(a.posY-g.posY)/b;var j=new Audio("collide.mp3"),k=(i(a.velX,a.velY)*(1-a.collisonFactor)+i(g.velX,g.velY)*(1-g.collisonFactor))/(60*(1-a.collisonFactor));k>1?j.volume=1:j.volume=k,j.play()}}}function WhiteBall(){var a=function(){var a=document.createElement("div"),b=document.getElementsByClassName("board")[0],c="whiteBall";return a.setAttribute("class",c),b.appendChild(a),a},b=function(){f.element.style.left=f.posX+"px",f.element.style.top=f.posY+"px"},c=function(){1==f.deadFlag?f.element.style.visibility="hidden":f.element.style.visibility="visible"};this.element=a();var d=.03,e=.098,f=this;this.velX=0,this.velY=0,this.posX,this.posY,this.radius=12,this.mass=1,this.identity,this.velFlag=!1,this.deadFlag=!1,this.collisionFlag=!1,this.firstCollide=0,this.collisonFactor=.95;var h=function(a,b){return Math.sqrt(Math.pow(a,2)+Math.pow(b,2))};this.initialise=function(a,c,d){f.posX=a,f.posY=c,f.identity=d,b()},this.reposition=function(){f.deadFlag=!1,f.posX=195,f.posY=200,b(),c()},this.makeDead=function(){f.velX=0,f.velY=0,f.deadFlag=!0,f.posX=0,f.posY=0,c()},this.reset=function(){f.collisionFlag=!1,f.firstCollide=0},this.velocityStarter=function(a,b,c){var d=(f.posX+f.radius-a)/Math.sqrt(Math.pow(f.posX+f.radius-a,2)+Math.pow(f.posY+f.radius-b,2)),e=(f.posY+f.radius-b)/Math.sqrt(Math.pow(f.posX+f.radius-a,2)+Math.pow(f.posY+f.radius-b,2));f.velX=c*d,f.velY=c*e},this.move=function(){f.posX+=f.velX,f.posY+=f.velY;var a=Math.sqrt(Math.pow(f.velX,2)+Math.pow(f.velY,2));a>0?f.velFlag=!0:f.velFlag=!1;var c=a-d*e;c>.8?(f.velX*=c/a,f.velY*=c/a):(f.velX=0,f.velY=0),b()},this.hitTest=function(a){var b=Math.sqrt(Math.pow(this.posX-a.posX,2)+Math.pow(this.posY-a.posY,2));if(b<=f.radius+a.radius){var c=(a.posX-f.posX)/b,d=(a.posY-f.posY)/b,e=2*(f.velX*c+f.velY*d-a.velX*c-a.velY*d)/(f.mass+a.mass);f.velX=(f.velX-e*f.mass*c)*f.collisonFactor,f.velY=(f.velY-e*f.mass*d)*f.collisonFactor,a.velX=(a.velX+e*a.mass*c)*f.collisonFactor,a.velY=(a.velY+e*a.mass*d)*f.collisonFactor;var g=(f.posX+a.posX)/2,i=(f.posY+a.posY)/2;f.posX=g+f.radius*(f.posX-a.posX)/b,f.posY=i+f.radius*(f.posY-a.posY)/b,a.posX=g+a.radius*(a.posX-f.posX)/b,a.posY=i+a.radius*(a.posY-f.posY)/b,0==f.collisionFlag&&(f.collisionFlag=!0,f.firstCollide=a.identity);var j=new Audio("collide.mp3"),k=(h(a.velX,a.velY)*(1-a.collisonFactor)+h(f.velX,f.velY)*(1-f.collisonFactor))/(60*(1-a.collisonFactor));k>1?j.volume=1:j.volume=k,j.play()}}}function Power(){var a,b=function(){var b=document.createElement("div"),c=document.getElementsByClassName("background")[0],d="pow-wrapper";b.setAttribute("class",d),c.appendChild(b);var e=document.getElementsByClassName("pow-wrapper")[0];a=document.createElement("div"),a.setAttribute("class","pow-bg"),e.appendChild(a)},c=function(){e.button=document.createElement("button"),e.button.innerHTML="POWER LEVEL",document.getElementsByClassName("pow-wrapper")[0].appendChild(e.button),e.button.style.position="absolute",e.button.style.bottom="0px",e.button.style.width="100%",e.button.style.height="50px"},d=function(b){a.style.top=e.topValue+"px"},e=this;this.button,b(),c();var f=250;this.powerLevel=0,this.topValue=250,this.vely=-1,this.resetToBottom=function(){e.topValue=f,d()},this.powerMover=function(){e.topValue>=f&&(e.vely=-1),e.topValue<=0&&(e.vely=1),e.topValue+=2*e.vely,e.powerLevel=f-e.topValue,d()}}function Stick(){var a=function(){for(var a=0;a<3;a++){var d=document.createElement("div"),e=document.getElementsByClassName("board")[0],f=document.getElementsByClassName("stick")[0];0==a?(c(d,"stick"),b(d,e),j.wrp=d,h()):1==a?(c(d,"innerstick"),b(d,f),j.mainStick=d):(c(d,"stick-arrow"),b(d,f),i=d,g())}},b=function(a,b){b.appendChild(a)},c=function(a,b){a.setAttribute("class",a.getAttribute("class")+" "+b)},d=function(){1==j.hiddenFlag?j.wrp.style.visibility="hidden":j.wrp.style.visibility="visible"},e=function(a,b){j.wrp.style.left=a+"px",j.wrp.style.top=b+"px"},f=function(){j.mainStick.style.marginLeft=j.stickMargin+"px"},g=function(){i.style.width=p+"px",i.style.marginRight=q+"px"},h=function(){j.wrp.style.width=n+"px"};this.wrp,this.mainStick;var i,j=this,k=.8,l=383,m=12,n=2*l+8*m,o=12,p=l*k+3*m,q=(1-k)*l;this.posX,this.posY,this.rotatedX,this.rotatedY,this.angle=0,this.stickMargin=0,this.hiddenFlag=!0,this.move=function(a){return j.stickMargin+=1*a,f(),j.stickMargin>=3*m&&(j.stickMargin=0,f(),!0)},this.hide=function(){j.hiddenFlag=!0,d()},this.initialise=function(a,b){j.posX=a,j.posY=b,e(a,b-o/2)},this.rotate=function(){j.rotatedX=j.posX+n/2-5*Math.cos(Math.PI/180*j.angle),j.rotatedY=j.posY-5*Math.sin(Math.PI/180*j.angle)},this.placeStick=function(a,b){var c=a+m-n/2,e=b+m;j.initialise(c,e),j.hiddenFlag=!1,d()},a()}function Board(){var a=function(){var a=document.createElement("div"),b="board",c=document.getElementsByClassName("background")[0];return a.setAttribute("class",b),c.appendChild(a),a};this.element=a();var b=this,c=770,d=45,e=430,f=58,g=365,h=380,b=this,j=.95;this.numBalls=16,this.ballsArray=new Array,this.stick;var k=function(){var a=[195,200,550,199,574,213,574,188,598,175,598,225,622,238,622,212,622,187,622,162,646,150,646,175,646,200,646,225,646,250,598,200];for(i=0;i<b.numBalls;i++){var c;c=0==i?new WhiteBall:new Ball(15==i?"blackBall":i%2==0?"blueBall":"redBall"),c.initialise(a[2*i],a[2*i+1],i),b.ballsArray[i]=c}},l=function(){for(var a=0;a<b.ballsArray.length;a++){b.ballsArray[a].move();for(var c=a+1;c<b.ballsArray.length;c++)a!=c&&b.ballsArray[a].hitTest(b.ballsArray[c])}},m=function(){for(var a=0;a<b.ballsArray.length;a++)b.ballsArray[a].posX<=d&&(b.ballsArray[a].posY<f||b.ballsArray[a].posY>e-f-3?b.ballsArray[a].makeDead():b.ballsArray[a].velX=Math.abs(j*b.ballsArray[a].velX)),b.ballsArray[a].posX>=c-d-2*b.ballsArray[a].radius&&(b.ballsArray[a].posY<f||b.ballsArray[a].posY>e-f-3?b.ballsArray[a].makeDead():b.ballsArray[a].velX=-1*Math.abs(j*b.ballsArray[a].velX)),b.ballsArray[a].posY<=d&&(b.ballsArray[a].posX<f||b.ballsArray[a].posX>c-f-3||b.ballsArray[a].posX>g&&b.ballsArray[a].posX<h?b.ballsArray[a].makeDead():b.ballsArray[a].velY=Math.abs(j*b.ballsArray[a].velY)),b.ballsArray[a].posY>=e-d-2*b.ballsArray[a].radius&&(b.ballsArray[a].posX<f||b.ballsArray[a].posX>c-f-3||b.ballsArray[a].posX>g&&b.ballsArray[a].posX<h?b.ballsArray[a].makeDead():b.ballsArray[a].velY=-1*Math.abs(j*b.ballsArray[a].velY))};this.velProfile=function(){for(var a=0;a<b.ballsArray.length;a++)if(1==b.ballsArray[a].velFlag)return!0;return!1},this.ballMover=function(){l(),m()};var n=function(){b.stick=new Stick},o=function(){k(),n()};o()}function ScoreBoard(){var a=function(){for(var a=document.getElementsByClassName("background")[0],e="score-wrp",f=0;f<=12;f++){var g=document.createElement("div");if(0==f)c(g,e),b(g,a);else if(f<=2){var h=document.getElementsByClassName("score-wrp")[0];c(g,"score-main"),b(g,h)}else if(f<=7){var h=document.getElementsByClassName("score-main")[0];c(g,"score-block"),b(g,h)}else{var h=document.getElementsByClassName("score-main")[1];c(g,"score-block"),b(g,h)}d.blocksArray[f]=g}},b=function(a,b){b.appendChild(a)},c=function(a,b){a.setAttribute("class",a.getAttribute("class")+" "+b)},d=this;this.blocksArray=new Array,a();var e=["","ACTIVE",1,"RED + BLUE","PENDING","","PASSIVE",0,"RED+BLUE","PENDING"],f=["PLAYER 1","STATUS","HIT REMAINING","BALL-TYPE","BALLS ","PLAYER2","STATUS","HITREMAINING","BALL-TYPE","BALLS"],g=function(){for(i=0;i<f.length;i++)d.blocksArray[3+i].innerHTML=f[i]+" :  "+e[i]};g(),this.assignValue=function(a){e=a,g()}}function Background(a){var b=function(a){var b=document.createElement("div"),c="background";return b.setAttribute("class",c),a.appendChild(b),b},c=function(){var a=document.createElement("button");return a.style.backgroundImage="url(images/newGame.png)",a.style.backgroundSize="100%",a.style.backgroundRepeat="no-repeat",a.style.position="absolute",a.style.bottom="60px",a.style.right="0px",a.style.width="13%",a.style.marginRight="2%",a.style.height="40px",document.getElementsByClassName("background")[0].appendChild(a),a};this.element=b(a),this.newGameButton=c();var d=this;this.widthValue=1200,this.heightValue=500,this.board,this.scoreBoard,this.power;var e=function(){d.scoreBoard=new ScoreBoard,d.board=new Board,d.power=new Power};e()}function Player(){this.identity,this.ballsLeft=7,this.ballCatageory=2,this.hitRemaining=0,this.activeStatus=!1}function Rule(){var a=this,b=function(){var a=document.createElement("div"),b="info-board",c=document.getElementsByClassName("board")[0];return a.setAttribute("class",b),c.appendChild(a),a},c=function(b){a.element.style.visibility="visible",a.element.innerHTML=b};this.hideBoard=function(){a.element.style.visibility="hidden"},this.element=b();var e=!1,f=!1,g=!1,h=!1,i=function(a,b){0==b||15==b?e=!0:b%2!=a.ballCatageory&&2!=a.ballCatageory&&(e=!0)},j=function(a,b){var c=[0,0];if(2!=a.ballCatageory)for(var d=1;d<b.length-1;d++)b[d].identity%2==a.ballCatageory?c[0]+=1:c[1]+=1;return c},k=function(a){return 2==a.ballCatageory?1:2},l=function(a,b,c){var d=0,f=0;1==c[0].deadFlag&&(c[0].reposition(),e=!0);for(var g=1;g<c.length-1;g++)c[g].identity%2==0&&1==c[g].deadFlag&&d++,c[g].identity%2!=0&&1==c[g].deadFlag&&f++;0==e&&(d>=1&&0==f&&(a.ballCatageory=0,b.ballCatageory=1),f>=1&&0==d&&(a.ballCatageory=1,b.ballCatageory=0))},m=function(a,b){a.ballCatageory;1==b[0].deadFlag&&(b[0].reposition(),e=!0);for(var d=1;d<b.length;d++)1==b[d].deadFlag&&(15==b[d].identity?g=!0:b[d].identity%2!=a.ballCatageory?e=!0:f=!0,b.splice(d,1),d--)},n=function(a,b,c,d){a.hitRemaining=c,a.activeStatus=b,a.ballsLeft=d};this.ruleTest=function(a,b,d){var p,q,r;if(1==b[0].activeStatus?(p=b[0],q=b[1]):(p=b[1],q=b[0]),i(p,d),2==p.ballCatageory&&l(p,q,a),m(p,a),r=j(p,a),2==p.ballCatageory&&(r=["pending","pending"]),1==g)c(2!=p.ballCatageory&&1!=e&&0==p.ballsLeft?"PLAYER "+p.identity+" : WINNER":"PLAYER "+q.identity+" : WINNER"),h=!0;else if(1==e){n(p,!1,0,r[0]);var t=k(q);n(q,!0,t,r[1]),c("FOUL")}else 0!=e||2!=p.hitRemaining&&1!=f?(n(p,!1,0,r[0]),n(q,!0,1,r[1]),c("NEXT PLAYER")):(n(p,!0,1,r[0]),n(q,!1,0,r[1]),c("NEXT HIT"));var u=["",b[0].activeStatus,b[0].hitRemaining,b[0].ballCatageory,b[0].ballsLeft,"",b[1].activeStatus,b[1].hitRemaining,b[1].ballCatageory,b[1].ballsLeft];return e=!1,f=!1,0==h?o(u):1};var o=function(a){var b=a;return 1==a[1]&&(b[1]="ACTIVE",b[6]="PASSIVE"),0==a[1]&&(b[1]="PASSIVE",b[6]="ACTIVE"),2==a[3]&&(b[3]="RED + BLUE",b[8]="RED + BLUE"),0==a[3]&&(b[3]="BLUE",b[8]="RED"),1==a[3]&&(b[3]="RED",b[8]="BLUE"),0==a[4]&&(b[4]=1,b[3]="BLACK"),0==a[9]&&(b[9]=1,b[8]="BLACK"),b}}function GameWindow(a){var b=a,c=this;this.players=new Array,this.bg,this.gameRule;var d=function(){for(var a=0;a<2;a++){var b=new Player;0==a&&(b.activeStatus=!0,b.hitRemaining=1),b.identity=a+1,c.players[a]=b}},e=function(a){var b=new Background(a);c.bg=b},f=function(){c.gameRule=new Rule},g=function(a){e(a),d(),f()};g(b)}function Game(){var a=new Loading,b=0,c=this;this.parentClass=document.getElementsByTagName("body")[0],this.childClass,this.init=function(){var m,d=!1,e=0,f=!1,g=!0,h=!1,i=!1,j=!1,k=!1,l=0,n=new GameWindow(this.parentClass),p=(new Rotator(n.bg.board.stick),!1);c.childClass=n.bg.element;var q=function(){n.bg.board.stick.placeStick(n.bg.board.ballsArray[0].posX,n.bg.board.ballsArray[0].posY),n.bg.board.stick.rotate()},r=function(a){n.bg.scoreBoard.assignValue(a)},s=function(){b<500?(b++,a.loadingMover(500)):(1==g&&n.bg.power.powerMover(),1==h&&(n.bg.power.resetToBottom(),i=n.bg.board.stick.move(e/2),k=!1),1==i&&(h=!1,n.bg.board.ballsArray[0].velocityStarter(n.bg.board.stick.rotatedX,n.bg.board.stick.rotatedY,e),f=!0,i=!1,j=!0),1==j&&(n.bg.board.stick.hide(),n.bg.board.ballMover(),k=!n.bg.board.velProfile()),1==k&&(j=!1,k=!1,m=n.gameRule.ruleTest(n.bg.board.ballsArray,n.players,n.bg.board.ballsArray[0].firstCollide),1==m?clearInterval(t):r(m),l++),l>0&&(l++,l>150&&(n.gameRule.hideBoard(),g=!0,d=!1,n.bg.board.ballsArray[0].reset(),q(),l=0)))},t=setInterval(s,10);q(),n.bg.power.button.onclick=function(){0==d&&(d=!0,e=n.bg.power.powerLevel/30,g=!1,h=!0)},n.bg.newGameButton.onclick=function(){0==p&&(p=!0,c.parentClass.removeChild(c.childClass),c.init(),p=!1)}}}Rotator=function(a){var b=a.wrp,c=!1,d=[],e=[],f=[],g=[],h=0,i=0,j=0,k=0,l=6.283185307179586,m=360,n={};n.rad=0,n.deg=0,n.per=0,n.radianValue=0,n.degValue=0,n.spin=0,n.clock=!1,n.onchange=function(){};var o=function(a){1==window.event&&(a=window.event),1==a.preventDefault?a.preventDefault():a.returnValue=!1},p=function(a){for(var b=a,c=b.offsetLeft,d=b.offsetTop;b=b.offsetParent;)c+=b.offsetLeft;for(b=a;b=b.offsetParent;)d+=b.offsetTop;return[c,d]},q=function(a){return[a.offsetWidth,a.offsetHeight]},r=function(a){return[p(a)[0]+q(a)[0]/2,p(a)[1]+q(a)[1]/2]},s=function(a){var b;1==window.event&&(a=window.event),1==a.clientX&&(b=[a.clientX,a.clientY]),a.pageX&&(b=[a.pageX,a.pageY]);try{a.targetTouches[0]&&(b=[a.targetTouches[0].pageX,a.targetTouches[0].pageY])}catch(a){}return b},t=function(a){var c;d=p(b),e=q(b),f=r(b),g=s(a);try{c=Math.atan2(g[1]-f[1],g[0]-f[0])}catch(a){}return c+=l/4,c<0&&(c+=l),c},u=function(a,b){b?(o(a),h=t(a),c=!0):c=!1},v=function(d){if(c){var e,f,g;e=t(d),f=e-h;var g=i+f;isNaN(g)&&(g=i),g<0&&(g=l),g>l&&(g=0),h=e,b.style.transform="rotate("+g+"rad)",b.style.MozTransform="rotate("+g+"rad)",b.style.WebkitTransform="rotate("+g+"rad)",b.style.OTransform="rotate("+g+"rad)",b.style.MsTransform="rotate("+g+"rad)",n.rad=g,n.deg=m*n.rad/(2*Math.PI),j<=100&&j>=60&&n.per>=0&&n.per<=30&&n.spin++,j<=30&&j>=0&&n.per>=60&&n.per<=100&&n.spin--,n.radianValue=n.rad+l*n.spin,n.degValue=n.deg+m*n.spin,k<n.radianValue&&(n.clock=!0),k>n.radianValue&&(n.clock=!1),i=g,j=n.per,k=n.radianValue,n.onchange(),a.angle=n.degValue,a.rotate()}};if(b.attachEvent)b.attachEvent("onmousedown",function(){u(0,!0)}),document.attachEvent("onmouseup",function(){u(0,!1)}),document.attachEvent("onmousemove",function(){v(0)});else if(b.addEventListener){b.addEventListener("mousedown",function(a){u(a,!0)}),document.addEventListener("mouseup",function(a){u(a,!1)}),document.addEventListener("mousemove",function(a){v(a)});try{b.addEventListener("touchstart",function(a){u(a,!0)})}catch(a){}try{document.addEventListener("touchend",function(a){u(a,!1)})}catch(a){}try{document.addEventListener("touchmove",function(a){v(a)})}catch(a){}}return n};var game=new Game;game.init();
